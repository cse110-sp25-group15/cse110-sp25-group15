<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>listing-form/listing-form.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AuthPill.html">AuthPill</a><ul class='methods'><li data-type='method'><a href="AuthPill.html#_renderLoginUI">_renderLoginUI</a></li><li data-type='method'><a href="AuthPill.html#_renderMenuClosed">_renderMenuClosed</a></li><li data-type='method'><a href="AuthPill.html#_renderMenuOpen">_renderMenuOpen</a></li><li data-type='method'><a href="AuthPill.html#_renderUserUI">_renderUserUI</a></li></ul></li><li><a href="BottomNav.html">BottomNav</a><ul class='methods'><li data-type='method'><a href="BottomNav.html#_renderEmailCleared">_renderEmailCleared</a></li><li data-type='method'><a href="BottomNav.html#_renderNewsletterSuccess">_renderNewsletterSuccess</a></li></ul></li><li><a href="BrowsePage.html">BrowsePage</a><ul class='methods'><li data-type='method'><a href="BrowsePage.html#_renderDefaultCategory">_renderDefaultCategory</a></li></ul></li><li><a href="CategoryButton.html">CategoryButton</a><ul class='methods'><li data-type='method'><a href="CategoryButton.html#_renderSelected">_renderSelected</a></li></ul></li><li><a href="ChatWidget.html">ChatWidget</a><ul class='methods'><li data-type='method'><a href="ChatWidget.html#_renderBottomNavPosition">_renderBottomNavPosition</a></li><li data-type='method'><a href="ChatWidget.html#_renderChatScreen">_renderChatScreen</a></li><li data-type='method'><a href="ChatWidget.html#_renderConversationList">_renderConversationList</a></li><li data-type='method'><a href="ChatWidget.html#_renderConversations">_renderConversations</a></li><li data-type='method'><a href="ChatWidget.html#_renderDisclaimer">_renderDisclaimer</a></li><li data-type='method'><a href="ChatWidget.html#_renderInitialState">_renderInitialState</a></li><li data-type='method'><a href="ChatWidget.html#_renderWidgetHidden">_renderWidgetHidden</a></li><li data-type='method'><a href="ChatWidget.html#_renderWidgetVisible">_renderWidgetVisible</a></li></ul></li><li><a href="EditListingModal.html">EditListingModal</a><ul class='methods'><li data-type='method'><a href="EditListingModal.html#_renderBodyScrollLocked">_renderBodyScrollLocked</a></li><li data-type='method'><a href="EditListingModal.html#_renderBodyScrollUnlocked">_renderBodyScrollUnlocked</a></li><li data-type='method'><a href="EditListingModal.html#_renderFormData">_renderFormData</a></li><li data-type='method'><a href="EditListingModal.html#_renderFormReset">_renderFormReset</a></li><li data-type='method'><a href="EditListingModal.html#_renderImageGallery">_renderImageGallery</a></li><li data-type='method'><a href="EditListingModal.html#_renderImageNavigation">_renderImageNavigation</a></li><li data-type='method'><a href="EditListingModal.html#_renderImagePreview">_renderImagePreview</a></li><li data-type='method'><a href="EditListingModal.html#_renderLoadingHidden">_renderLoadingHidden</a></li><li data-type='method'><a href="EditListingModal.html#_renderLoadingVisible">_renderLoadingVisible</a></li><li data-type='method'><a href="EditListingModal.html#_renderModalHidden">_renderModalHidden</a></li><li data-type='method'><a href="EditListingModal.html#_renderModalVisible">_renderModalVisible</a></li><li data-type='method'><a href="EditListingModal.html#_renderWordCount">_renderWordCount</a></li></ul></li><li><a href="EmptyState.html">EmptyState</a></li><li><a href="HeroBanner.html">HeroBanner</a></li><li><a href="ListingForm.html">ListingForm</a><ul class='methods'><li data-type='method'><a href="ListingForm.html#_renderBodyScrollLocked">_renderBodyScrollLocked</a></li><li data-type='method'><a href="ListingForm.html#_renderBodyScrollUnlocked">_renderBodyScrollUnlocked</a></li><li data-type='method'><a href="ListingForm.html#_renderDragHover">_renderDragHover</a></li><li data-type='method'><a href="ListingForm.html#_renderDragLeave">_renderDragLeave</a></li><li data-type='method'><a href="ListingForm.html#_renderPreviewContent">_renderPreviewContent</a></li><li data-type='method'><a href="ListingForm.html#_renderPreviewGallery">_renderPreviewGallery</a></li><li data-type='method'><a href="ListingForm.html#_renderPreviewHidden">_renderPreviewHidden</a></li><li data-type='method'><a href="ListingForm.html#_renderPreviewVisible">_renderPreviewVisible</a></li><li data-type='method'><a href="ListingForm.html#_renderUploadLabel">_renderUploadLabel</a></li><li data-type='method'><a href="ListingForm.html#_renderUploadedFiles">_renderUploadedFiles</a></li><li data-type='method'><a href="ListingForm.html#_renderWordCount">_renderWordCount</a></li></ul></li><li><a href="MyListings.html">MyListings</a><ul class='methods'><li data-type='method'><a href="MyListings.html#_renderAllStatesHidden">_renderAllStatesHidden</a></li><li data-type='method'><a href="MyListings.html#_renderEmptyState">_renderEmptyState</a></li><li data-type='method'><a href="MyListings.html#_renderErrorState">_renderErrorState</a></li><li data-type='method'><a href="MyListings.html#_renderListings">_renderListings</a></li><li data-type='method'><a href="MyListings.html#_renderLoading">_renderLoading</a></li></ul></li><li><a href="Notification.html">Notification</a><ul class='methods'><li data-type='method'><a href="Notification.html#_renderHidden">_renderHidden</a></li><li data-type='method'><a href="Notification.html#_renderNotification">_renderNotification</a></li><li data-type='method'><a href="Notification.html#_renderVisible">_renderVisible</a></li></ul></li><li><a href="ProductViewer.html">ProductViewer</a><ul class='methods'><li data-type='method'><a href="ProductViewer.html#_renderBodyScrollLocked">_renderBodyScrollLocked</a></li><li data-type='method'><a href="ProductViewer.html#_renderBodyScrollUnlocked">_renderBodyScrollUnlocked</a></li><li data-type='method'><a href="ProductViewer.html#_renderContactDisclaimer">_renderContactDisclaimer</a></li><li data-type='method'><a href="ProductViewer.html#_renderContent">_renderContent</a></li><li data-type='method'><a href="ProductViewer.html#_renderMainImage">_renderMainImage</a></li><li data-type='method'><a href="ProductViewer.html#_renderOverlayHidden">_renderOverlayHidden</a></li><li data-type='method'><a href="ProductViewer.html#_renderOverlayVisible">_renderOverlayVisible</a></li><li data-type='method'><a href="ProductViewer.html#_renderProductInfo">_renderProductInfo</a></li><li data-type='method'><a href="ProductViewer.html#_renderTextField">_renderTextField</a></li><li data-type='method'><a href="ProductViewer.html#_renderThumbnails">_renderThumbnails</a></li></ul></li><li><a href="ProfileInfo.html">ProfileInfo</a><ul class='methods'><li data-type='method'><a href="ProfileInfo.html#_renderAvatar">_renderAvatar</a></li><li data-type='method'><a href="ProfileInfo.html#_renderAvatarFallback">_renderAvatarFallback</a></li><li data-type='method'><a href="ProfileInfo.html#_renderError">_renderError</a></li><li data-type='method'><a href="ProfileInfo.html#_renderLoading">_renderLoading</a></li><li data-type='method'><a href="ProfileInfo.html#_renderProfile">_renderProfile</a></li><li data-type='method'><a href="ProfileInfo.html#_renderProfileInfo">_renderProfileInfo</a></li></ul></li><li><a href="SearchBox.html">SearchBox</a><ul class='methods'><li data-type='method'><a href="SearchBox.html#connectedCallback">connectedCallback</a></li><li data-type='method'><a href="SearchBox.html#setupEventListeners">setupEventListeners</a></li><li data-type='method'><a href="SearchBox.html#toggleSearch">toggleSearch</a></li></ul></li><li><a href="SearchHero.html">SearchHero</a><ul class='methods'><li data-type='method'><a href="SearchHero.html#_renderActiveCategory">_renderActiveCategory</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-ApplicationOverview.html">ApplicationOverview</a></li><li><a href="tutorial-DatabaseGuide.html">DatabaseGuide</a></li><li><a href="tutorial-JavaScriptGuide.html">JavaScriptGuide</a></li><li><a href="tutorial-OnBoarding.html">OnBoarding</a></li><li><a href="tutorial-WebComponentGuide.html">WebComponentGuide</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">listing-form/listing-form.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import html from './listing-form.html?raw';
import css from './listing-form.css?raw';

/**
 * A comprehensive form component for creating marketplace listings with media upload support.
 * 
 * States:
 * - Default: Form ready for input with no files uploaded
 * - Files Uploaded: Shows uploaded files with reorder/remove controls
 * - Preview Mode: Modal showing listing preview with media gallery
 * - Drag Hover: Visual feedback during file drag operations
 * 
 * Purpose:
 * - Collects listing data (title, price, category, condition, description)
 * - Handles multiple file uploads with drag &amp; drop support
 * - Provides file reordering and removal functionality
 * - Shows live preview of the listing with media gallery
 * - Validates form data and emits listing-submit events
 * - Manages word count for description field
 * - Formats price input automatically
 */
class ListingForm extends HTMLElement {
  constructor() {
    super();
    this.attachShadow({ mode: 'open' });
    
    const template = document.createElement('template');
    template.innerHTML = `&lt;style>${css}&lt;/style>${html}`;
    this.shadowRoot.appendChild(template.content.cloneNode(true));

    this.uploadedFiles = [];
    this._currentPreviewIndex = 0;
  }

  connectedCallback() {
    // Bind DOM elements
    this.form = this.shadowRoot.querySelector('.listing-form');
    this.wordCounter = this.shadowRoot.querySelector('#word-count');
    this.descriptionField = this.shadowRoot.querySelector('#description');
    this.mediaInput = this.shadowRoot.querySelector('#media-upload');
    this.previewModal = this.shadowRoot.querySelector('#preview-modal');
    this.closePreviewButton = this.shadowRoot.querySelector('.close-preview');
    this.previewContainer = this.shadowRoot.querySelector('.preview-container');
    this.previewButton = this.shadowRoot.querySelector('#preview-button');
    this.uploadArea = this.shadowRoot.querySelector('.upload-area');
    this.uploadLabel = this.shadowRoot.querySelector('.upload-label');
    this.priceInput = this.form.querySelector('input[name="price"]');

    // Bind event handlers
    this._handleSubmit = this._handleSubmit.bind(this);
    this._handleDescriptionInput = this._handleDescriptionInput.bind(this);
    this._handleFileSelect = this._handleFileSelect.bind(this);
    this._handleShowPreview = this._handleShowPreview.bind(this);
    this._handleHidePreview = this._handleHidePreview.bind(this);
    this._handleKeydown = this._handleKeydown.bind(this);
    this._handleDrop = this._handleDrop.bind(this);
    this._handlePriceInput = this._handlePriceInput.bind(this);
    this._handleDragEnter = this._handleDragEnter.bind(this);
    this._handleDragOver = this._handleDragOver.bind(this);
    this._handleDragLeave = this._handleDragLeave.bind(this);

    // Add event listeners
    this.form.addEventListener('submit', this._handleSubmit);
    this.descriptionField.addEventListener('input', this._handleDescriptionInput);
    this.mediaInput.addEventListener('change', this._handleFileSelect);
    this.previewButton.addEventListener('click', this._handleShowPreview);
    this.closePreviewButton.addEventListener('click', this._handleHidePreview);
    this.shadowRoot.addEventListener('keydown', this._handleKeydown);
    this.priceInput.addEventListener('input', this._handlePriceInput);

    // Setup drag and drop
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach((eventName) => {
      this.uploadArea.addEventListener(eventName, this._preventDefaults, false);
    });

    ['dragenter', 'dragover'].forEach((eventName) => {
      this.uploadArea.addEventListener(eventName, this._handleDragEnter, false);
    });

    ['dragleave', 'drop'].forEach((eventName) => {
      this.uploadArea.addEventListener(eventName, this._handleDragLeave, false);
    });

    this.uploadArea.addEventListener('drop', this._handleDrop, false);
  }

  disconnectedCallback() {
    this.form.removeEventListener('submit', this._handleSubmit);
    this.descriptionField.removeEventListener('input', this._handleDescriptionInput);
    this.mediaInput.removeEventListener('change', this._handleFileSelect);
    this.previewButton.removeEventListener('click', this._handleShowPreview);
    this.closePreviewButton.removeEventListener('click', this._handleHidePreview);
    this.shadowRoot.removeEventListener('keydown', this._handleKeydown);
    this.priceInput.removeEventListener('input', this._handlePriceInput);

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach((eventName) => {
      this.uploadArea.removeEventListener(eventName, this._preventDefaults);
    });

    ['dragenter', 'dragover'].forEach((eventName) => {
      this.uploadArea.removeEventListener(eventName, this._handleDragEnter);
    });

    ['dragleave', 'drop'].forEach((eventName) => {
      this.uploadArea.removeEventListener(eventName, this._handleDragLeave);
    });

    this.uploadArea.removeEventListener('drop', this._handleDrop);

    this._renderBodyScrollUnlocked();
  }

  /**
   * Updates the word count display and exceeded state for description field
   */
  _renderWordCount() {
    const words = this.descriptionField.value.trim().split(/\s+/).filter(Boolean);
    const wordCount = words.length;
    this.wordCounter.textContent = `${wordCount}/250`;
    this.wordCounter.classList.toggle('exceeded', wordCount > 250);
  }

  /**
   * Renders the uploaded files display with thumbnails, reorder controls, and remove buttons
   */
  _renderUploadedFiles() {
    this.previewContainer.innerHTML = '';
    
    this.uploadedFiles.forEach((file, index) => {
      const fileCard = document.createElement('div');
      fileCard.className = 'file-card';
      
      if (index === 0) {
        fileCard.classList.add('is-thumbnail');
      }
      
      const thumbnail = document.createElement('div');
      thumbnail.className = 'thumbnail';
      
      if (file.type.startsWith('image/')) {
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        thumbnail.appendChild(img);
      } else if (file.type.startsWith('video/')) {
        const video = document.createElement('video');
        video.src = URL.createObjectURL(file);
        video.muted = true;
        thumbnail.appendChild(video);
        
        const playIcon = document.createElement('div');
        playIcon.className = 'play-icon';
        playIcon.innerHTML = 'â–¶';
        thumbnail.appendChild(playIcon);
      }
      
      const fileName = document.createElement('div');
      fileName.className = 'file-name';
      fileName.textContent = file.name.length > 20 ? 
        file.name.substring(0, 17) + '...' : file.name;
      
      if (index === 0) {
        const thumbnailBadge = document.createElement('div');
        thumbnailBadge.className = 'thumbnail-badge';
        thumbnailBadge.innerHTML = 'Main Photo';
        fileCard.appendChild(thumbnailBadge);
      }
      
      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.innerHTML = 'Ã—';
      removeBtn.addEventListener('click', () => this._handleRemoveFile(index));
      
      if (this.uploadedFiles.length > 1) {
        const reorderContainer = document.createElement('div');
        reorderContainer.className = 'reorder-buttons';
        
        if (index > 0) {
          const moveUpBtn = document.createElement('button');
          moveUpBtn.className = 'move-btn move-up';
          moveUpBtn.innerHTML = 'â†‘';
          moveUpBtn.title = 'Move up (make thumbnail)';
          moveUpBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            this._handleMoveFile(index, index - 1);
          });
          reorderContainer.appendChild(moveUpBtn);
        }
        
        if (index &lt; this.uploadedFiles.length - 1) {
          const moveDownBtn = document.createElement('button');
          moveDownBtn.className = 'move-btn move-down';
          moveDownBtn.innerHTML = 'â†“';
          moveDownBtn.title = 'Move down';
          moveDownBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            this._handleMoveFile(index, index + 1);
          });
          reorderContainer.appendChild(moveDownBtn);
        }
        
        fileCard.appendChild(reorderContainer);
      }
      
      fileCard.appendChild(thumbnail);
      fileCard.appendChild(fileName);
      fileCard.appendChild(removeBtn);
      
      this.previewContainer.appendChild(fileCard);
    });
  }

  /**
   * Updates the upload area label text based on uploaded file count
   */
  _renderUploadLabel() {
    const uploadIcon = this.uploadLabel.querySelector('.upload-icon');
    const uploadMain = this.uploadLabel.querySelector('.upload-main');
    const uploadSub = this.uploadLabel.querySelector('.upload-sub');
    const fileCount = this.uploadedFiles.length;
    
    if (fileCount === 0) {
      uploadIcon.textContent = 'ðŸ“';
      uploadMain.textContent = 'Drag &amp; Drop your files here';
      uploadSub.textContent = 'or click to browse';
    } else {
      uploadIcon.textContent = 'âœ“';
      uploadMain.textContent = `${fileCount} file${fileCount > 1 ? 's' : ''} selected`;
      uploadSub.innerHTML = 'Drop more files or &lt;strong>click to add more&lt;/strong>';
    }
  }

  /**
   * Shows the preview modal and locks body scroll
   */
  _renderPreviewVisible() {
    this.previewModal.classList.add('visible');
    this._renderBodyScrollLocked();
  }

  /**
   * Hides the preview modal and unlocks body scroll
   */
  _renderPreviewHidden() {
    this.previewModal.classList.remove('visible');
    this._renderBodyScrollUnlocked();
    this._currentPreviewIndex = 0;
  }

  /**
   * Locks body scroll and adds padding to prevent layout shift
   */
  _renderBodyScrollLocked() {
    document.body.style.overflow = 'hidden';
    const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
    document.body.style.paddingRight = `${scrollbarWidth}px`;
  }

  /**
   * Unlocks body scroll and removes padding
   */
  _renderBodyScrollUnlocked() {
    document.body.style.overflow = '';
    document.body.style.paddingRight = '';
  }

  /**
   * Updates the preview modal content with current form data
   */
  _renderPreviewContent(data) {
    const previewTitle = this.shadowRoot.querySelector('.preview-title');
    if (previewTitle) {
      previewTitle.textContent = data.title || 'Untitled';
    }
    
    const priceEl = this.shadowRoot.querySelector('.preview-price');
    if (priceEl) {
      priceEl.textContent = data.price ? `$${parseFloat(data.price).toFixed(2)}` : '$0.00';
    }
    
    const conditionEl = this.shadowRoot.querySelector('.preview-condition');
    if (conditionEl) {
      conditionEl.textContent = data.condition || 'No condition selected';
    }
    
    const categoryEl = this.shadowRoot.querySelector('.preview-category');
    if (categoryEl) {
      categoryEl.textContent = data.category || 'No category selected';
    }
    
    const descEl = this.shadowRoot.querySelector('.preview-description');
    if (descEl) {
      descEl.textContent = data.description || 'No description provided';
    }
    
    this._renderPreviewGallery(data.files);
  }

  /**
   * Renders the media gallery in preview modal with navigation
   */
  _renderPreviewGallery(files) {
    const mainImageContainer = this.shadowRoot.querySelector('.preview-gallery-main');
    const thumbStrip = this.shadowRoot.querySelector('.preview-thumb-strip');
    
    if (!mainImageContainer || !thumbStrip) {return;}
    
    mainImageContainer.innerHTML = '';
    thumbStrip.innerHTML = '';
    
    if (!files || files.length === 0) {
      mainImageContainer.innerHTML = '&lt;div class="no-media">No media uploaded&lt;/div>';
      return;
    }
    
    const firstFile = files[0];
    let mainElement;
    
    if (firstFile.type.startsWith('image/')) {
      mainElement = document.createElement('img');
      mainElement.className = 'preview-main-image';
      mainElement.src = URL.createObjectURL(firstFile);
      mainElement.alt = 'Product preview';
    } else if (firstFile.type.startsWith('video/')) {
      mainElement = document.createElement('video');
      mainElement.className = 'preview-main-video';
      mainElement.src = URL.createObjectURL(firstFile);
      mainElement.controls = true;
      mainElement.muted = true;
    }
    
    if (mainElement) {
      mainImageContainer.appendChild(mainElement);
    }
    
    if (files.length > 1) {
      files.forEach((file, index) => {
        let thumbElement;
        
        if (file.type.startsWith('image/')) {
          thumbElement = document.createElement('img');
          thumbElement.src = URL.createObjectURL(file);
          thumbElement.alt = `Thumbnail ${index + 1}`;
        } else if (file.type.startsWith('video/')) {
          thumbElement = document.createElement('video');
          thumbElement.src = URL.createObjectURL(file);
          thumbElement.muted = true;
        }
        
        if (thumbElement) {
          thumbElement.className = index === this._currentPreviewIndex ? 'active' : '';
          
          if (index === 0) {
            thumbElement.style.border = '3px solid #f3c114';
            thumbElement.title = 'Main Photo (Thumbnail)';
          }
          
          thumbElement.addEventListener('click', () => this._handlePreviewThumbnailClick(index, file, mainImageContainer, thumbStrip));
          thumbStrip.appendChild(thumbElement);
        }
      });
    }
  }

  /**
   * Adds drag hover styling to upload area
   */
  _renderDragHover() {
    this.uploadArea.classList.add('drag-hover');
  }

  /**
   * Removes drag hover styling from upload area
   */
  _renderDragLeave() {
    this.uploadArea.classList.remove('drag-hover');
  }

  _handleSubmit(event) {
    event.preventDefault();
    const data = this._gatherFormData();
    const errors = this._validateForm(data);
    
    if (errors.length === 0) {
      this.dispatchEvent(new CustomEvent('listing-submit', {
        bubbles: true,
        composed: true,
        detail: data,
      }));
    } else {
      errors.forEach((error) => window.notify(error, 'warning', 4000));
    }
  }

  _handleDescriptionInput() {
    this._renderWordCount();
  }

  _handleFileSelect(e) {
    const files = e.target.files;
    this._processFiles(files);
  }

  _handleShowPreview() {
    const formData = this._gatherFormData();
    this._renderPreviewContent(formData);
    this._renderPreviewVisible();
  }

  _handleHidePreview() {
    this._renderPreviewHidden();
  }

  _handleKeydown(e) {
    if (e.key === 'Escape' &amp;&amp; this.previewModal.classList.contains('visible')) {
      this._renderPreviewHidden();
    }
  }

  _handleDrop(e) {
    this._renderDragLeave();
    const dt = e.dataTransfer;
    const files = dt.files;
    this._processFiles(files);
  }

  _handlePriceInput(e) {
    let value = e.target.value.replace(/[^\d.]/g, '');
    const parts = value.split('.');
    if (parts.length > 2) {
      value = parts[0] + '.' + parts.slice(1).join('');
    }
    if (parts[1] &amp;&amp; parts[1].length > 2) {
      value = parts[0] + '.' + parts[1].substring(0, 2);
    }
    e.target.value = value;
  }

  _handleDragEnter() {
    this._renderDragHover();
  }

  _handleDragOver() {
    this._renderDragHover();
  }

  _handleDragLeave() {
    this._renderDragLeave();
  }

  _handleRemoveFile(index) {
    this.uploadedFiles.splice(index, 1);
    this._renderUploadedFiles();
    this._renderUploadLabel();
    
    if (this.uploadedFiles.length === 0) {
      this.mediaInput.value = '';
    }
  }

  _handleMoveFile(fromIndex, toIndex) {
    const temp = this.uploadedFiles[fromIndex];
    this.uploadedFiles[fromIndex] = this.uploadedFiles[toIndex];
    this.uploadedFiles[toIndex] = temp;
    
    this._renderUploadedFiles();
    this._renderUploadLabel();
  }

  _handlePreviewThumbnailClick(index, file, mainImageContainer, thumbStrip) {
    this._currentPreviewIndex = index;
    
    mainImageContainer.innerHTML = '';
    let newMainElement;
    
    if (file.type.startsWith('image/')) {
      newMainElement = document.createElement('img');
      newMainElement.className = 'preview-main-image';
      newMainElement.src = URL.createObjectURL(file);
      newMainElement.alt = 'Product preview';
    } else if (file.type.startsWith('video/')) {
      newMainElement = document.createElement('video');
      newMainElement.className = 'preview-main-video';
      newMainElement.src = URL.createObjectURL(file);
      newMainElement.controls = true;
      newMainElement.muted = true;
    }
    
    if (newMainElement) {
      mainImageContainer.appendChild(newMainElement);
    }
    
    thumbStrip.querySelectorAll('img, video').forEach((el, i) => {
      el.className = i === index ? 'active' : '';
      if (i === 0) {
        el.style.border = '3px solid #f3c114';
        el.title = 'Main Photo (Thumbnail)';
      } else {
        el.style.border = '2px solid transparent';
        el.title = '';
      }
    });
  }

  _preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  _processFiles(files) {
    const validFiles = Array.from(files).filter((file) => {
      const isImage = file.type.startsWith('image/');
      const isVideo = file.type.startsWith('video/');
      return isImage || isVideo;
    });

    if (validFiles.length === 0) {
      window.notify('Please select valid image or video files', 'warning');
      return;
    }

    this.uploadedFiles = [...this.uploadedFiles, ...validFiles];
    this._renderUploadedFiles();
    this._renderUploadLabel();
  }

  _validateForm(data) {
    const errors = [];
    if (!data.title || data.title.length &lt; 3) {
      errors.push('Title must be at least 3 characters.');
    }
    if (!data.price || isNaN(parseFloat(data.price))) {
      errors.push('Please enter a valid price.');
    }
    if (!data.category) {
      errors.push('Please select a category.');
    }
    if (!data.condition) {
      errors.push('Please select a condition.');
    }
    if (data.description.split(/\s+/).filter(Boolean).length > 250) {
      errors.push('Description exceeds 250 words.');
    }
    return errors;
  }

  _gatherFormData() {
    return {
      title: this.form.querySelector('input[name="title"]').value.trim(),
      price: this.form.querySelector('input[name="price"]').value.trim(),
      category: this.form.querySelector('select[name="category"]').value,
      condition: this.form.querySelector('select[name="condition"]').value,
      description: this.form.querySelector('textarea[name="description"]').value.trim(),
      files: this.uploadedFiles,
    };
  }
}

customElements.define('listing-form', ListingForm);
export default ListingForm;</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Sun Jun 08 2025 21:24:11 GMT-0700 (Pacific Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
