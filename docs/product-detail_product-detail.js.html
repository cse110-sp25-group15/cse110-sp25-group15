<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>product-detail/product-detail.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AuthPill.html">AuthPill</a><ul class='methods'><li data-type='method'><a href="AuthPill.html#_renderLoginUI">_renderLoginUI</a></li><li data-type='method'><a href="AuthPill.html#_renderMenuClosed">_renderMenuClosed</a></li><li data-type='method'><a href="AuthPill.html#_renderMenuOpen">_renderMenuOpen</a></li><li data-type='method'><a href="AuthPill.html#_renderUserUI">_renderUserUI</a></li></ul></li><li><a href="BottomNav.html">BottomNav</a><ul class='methods'><li data-type='method'><a href="BottomNav.html#_renderEmailCleared">_renderEmailCleared</a></li><li data-type='method'><a href="BottomNav.html#_renderNewsletterSuccess">_renderNewsletterSuccess</a></li></ul></li><li><a href="BrowsePage.html">BrowsePage</a><ul class='methods'><li data-type='method'><a href="BrowsePage.html#_renderDefaultCategory">_renderDefaultCategory</a></li></ul></li><li><a href="CategoryButton.html">CategoryButton</a><ul class='methods'><li data-type='method'><a href="CategoryButton.html#_renderSelected">_renderSelected</a></li></ul></li><li><a href="ChatWidget.html">ChatWidget</a><ul class='methods'><li data-type='method'><a href="ChatWidget.html#_renderBottomNavPosition">_renderBottomNavPosition</a></li><li data-type='method'><a href="ChatWidget.html#_renderChatScreen">_renderChatScreen</a></li><li data-type='method'><a href="ChatWidget.html#_renderConversationList">_renderConversationList</a></li><li data-type='method'><a href="ChatWidget.html#_renderConversations">_renderConversations</a></li><li data-type='method'><a href="ChatWidget.html#_renderDisclaimer">_renderDisclaimer</a></li><li data-type='method'><a href="ChatWidget.html#_renderInitialState">_renderInitialState</a></li><li data-type='method'><a href="ChatWidget.html#_renderWidgetHidden">_renderWidgetHidden</a></li><li data-type='method'><a href="ChatWidget.html#_renderWidgetVisible">_renderWidgetVisible</a></li></ul></li><li><a href="EditListingModal.html">EditListingModal</a><ul class='methods'><li data-type='method'><a href="EditListingModal.html#_renderBodyScrollLocked">_renderBodyScrollLocked</a></li><li data-type='method'><a href="EditListingModal.html#_renderBodyScrollUnlocked">_renderBodyScrollUnlocked</a></li><li data-type='method'><a href="EditListingModal.html#_renderFormData">_renderFormData</a></li><li data-type='method'><a href="EditListingModal.html#_renderFormReset">_renderFormReset</a></li><li data-type='method'><a href="EditListingModal.html#_renderImageGallery">_renderImageGallery</a></li><li data-type='method'><a href="EditListingModal.html#_renderImageNavigation">_renderImageNavigation</a></li><li data-type='method'><a href="EditListingModal.html#_renderImagePreview">_renderImagePreview</a></li><li data-type='method'><a href="EditListingModal.html#_renderLoadingHidden">_renderLoadingHidden</a></li><li data-type='method'><a href="EditListingModal.html#_renderLoadingVisible">_renderLoadingVisible</a></li><li data-type='method'><a href="EditListingModal.html#_renderModalHidden">_renderModalHidden</a></li><li data-type='method'><a href="EditListingModal.html#_renderModalVisible">_renderModalVisible</a></li><li data-type='method'><a href="EditListingModal.html#_renderWordCount">_renderWordCount</a></li></ul></li><li><a href="EmptyState.html">EmptyState</a></li><li><a href="HeroBanner.html">HeroBanner</a></li><li><a href="ListingForm.html">ListingForm</a><ul class='methods'><li data-type='method'><a href="ListingForm.html#_renderBodyScrollLocked">_renderBodyScrollLocked</a></li><li data-type='method'><a href="ListingForm.html#_renderBodyScrollUnlocked">_renderBodyScrollUnlocked</a></li><li data-type='method'><a href="ListingForm.html#_renderDragHover">_renderDragHover</a></li><li data-type='method'><a href="ListingForm.html#_renderDragLeave">_renderDragLeave</a></li><li data-type='method'><a href="ListingForm.html#_renderPreviewContent">_renderPreviewContent</a></li><li data-type='method'><a href="ListingForm.html#_renderPreviewGallery">_renderPreviewGallery</a></li><li data-type='method'><a href="ListingForm.html#_renderPreviewHidden">_renderPreviewHidden</a></li><li data-type='method'><a href="ListingForm.html#_renderPreviewVisible">_renderPreviewVisible</a></li><li data-type='method'><a href="ListingForm.html#_renderUploadLabel">_renderUploadLabel</a></li><li data-type='method'><a href="ListingForm.html#_renderUploadedFiles">_renderUploadedFiles</a></li><li data-type='method'><a href="ListingForm.html#_renderWordCount">_renderWordCount</a></li></ul></li><li><a href="MyListings.html">MyListings</a><ul class='methods'><li data-type='method'><a href="MyListings.html#_renderAllStatesHidden">_renderAllStatesHidden</a></li><li data-type='method'><a href="MyListings.html#_renderEmptyState">_renderEmptyState</a></li><li data-type='method'><a href="MyListings.html#_renderErrorState">_renderErrorState</a></li><li data-type='method'><a href="MyListings.html#_renderListings">_renderListings</a></li><li data-type='method'><a href="MyListings.html#_renderLoading">_renderLoading</a></li></ul></li><li><a href="Notification.html">Notification</a><ul class='methods'><li data-type='method'><a href="Notification.html#_renderHidden">_renderHidden</a></li><li data-type='method'><a href="Notification.html#_renderNotification">_renderNotification</a></li><li data-type='method'><a href="Notification.html#_renderVisible">_renderVisible</a></li></ul></li><li><a href="ProductViewer.html">ProductViewer</a><ul class='methods'><li data-type='method'><a href="ProductViewer.html#_renderBodyScrollLocked">_renderBodyScrollLocked</a></li><li data-type='method'><a href="ProductViewer.html#_renderBodyScrollUnlocked">_renderBodyScrollUnlocked</a></li><li data-type='method'><a href="ProductViewer.html#_renderContactDisclaimer">_renderContactDisclaimer</a></li><li data-type='method'><a href="ProductViewer.html#_renderContent">_renderContent</a></li><li data-type='method'><a href="ProductViewer.html#_renderMainImage">_renderMainImage</a></li><li data-type='method'><a href="ProductViewer.html#_renderOverlayHidden">_renderOverlayHidden</a></li><li data-type='method'><a href="ProductViewer.html#_renderOverlayVisible">_renderOverlayVisible</a></li><li data-type='method'><a href="ProductViewer.html#_renderProductInfo">_renderProductInfo</a></li><li data-type='method'><a href="ProductViewer.html#_renderTextField">_renderTextField</a></li><li data-type='method'><a href="ProductViewer.html#_renderThumbnails">_renderThumbnails</a></li></ul></li><li><a href="ProfileInfo.html">ProfileInfo</a><ul class='methods'><li data-type='method'><a href="ProfileInfo.html#_renderAvatar">_renderAvatar</a></li><li data-type='method'><a href="ProfileInfo.html#_renderAvatarFallback">_renderAvatarFallback</a></li><li data-type='method'><a href="ProfileInfo.html#_renderError">_renderError</a></li><li data-type='method'><a href="ProfileInfo.html#_renderLoading">_renderLoading</a></li><li data-type='method'><a href="ProfileInfo.html#_renderProfile">_renderProfile</a></li><li data-type='method'><a href="ProfileInfo.html#_renderProfileInfo">_renderProfileInfo</a></li></ul></li><li><a href="SearchBox.html">SearchBox</a><ul class='methods'><li data-type='method'><a href="SearchBox.html#connectedCallback">connectedCallback</a></li><li data-type='method'><a href="SearchBox.html#setupEventListeners">setupEventListeners</a></li><li data-type='method'><a href="SearchBox.html#toggleSearch">toggleSearch</a></li></ul></li><li><a href="SearchHero.html">SearchHero</a><ul class='methods'><li data-type='method'><a href="SearchHero.html#_renderActiveCategory">_renderActiveCategory</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-ApplicationOverview.html">ApplicationOverview</a></li><li><a href="tutorial-DatabaseGuide.html">DatabaseGuide</a></li><li><a href="tutorial-JavaScriptGuide.html">JavaScriptGuide</a></li><li><a href="tutorial-OnBoarding.html">OnBoarding</a></li><li><a href="tutorial-WebComponentGuide.html">WebComponentGuide</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">product-detail/product-detail.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import templateHTML from './product-detail.html?raw';
import templateCSS from './product-detail.css?raw';

/**
 * A modal component that displays detailed product information in an overlay.
 * 
 * States:
 * - Hidden: Modal is not visible, body scroll is enabled
 * - Visible: Modal is displayed as overlay, body scroll is locked
 * - Gallery Navigation: User can navigate through multiple product images
 * - Contact Mode: Shows disclaimer after contact button is clicked
 * 
 * Purpose:
 * - Displays comprehensive product details in a modal overlay
 * - Provides image gallery with navigation for multiple product images
 * - Handles contact seller functionality with visual feedback
 * - Manages modal behavior (show/hide, escape key, overlay click)
 * - Prevents body scroll when modal is open
 * - Emits contact-seller events for parent components
 */
class ProductViewer extends HTMLElement {
  static get observedAttributes() {
    return ['name', 'price', 'condition', 'date', 'description', 'images', 'lister-name'];
  }

  constructor() {
    super();
    this.attachShadow({ mode: 'open' });
    
    const template = document.createElement('template');
    template.innerHTML = `&lt;style>${templateCSS}&lt;/style>${templateHTML}`;
    this.shadowRoot.appendChild(template.content.cloneNode(true));

    this._currentIndex = 0;
    this._isVisible = false;
    this.MSG_PLACEHOLDER = 'Hi, is this still available?';
  }

  connectedCallback() {
    // Bind DOM elements
    this.gallery = this.shadowRoot.querySelector('.gallery');
    this.sendButton = this.shadowRoot.querySelector('.send-btn');
    this.closeButton = this.shadowRoot.querySelector('.close-btn');
    this.overlay = this.shadowRoot.querySelector('.overlay');
    this.productDetail = this.shadowRoot.querySelector('.product-detail');
    this.mainImg = this.shadowRoot.querySelector('.main-image');
    this.thumbStrip = this.shadowRoot.querySelector('.thumb-strip');
    this.contactMsg = this.shadowRoot.querySelector('.contact-message');

    // Bind event handlers
    this._handleKeyDown = this._handleKeyDown.bind(this);
    this._handleContactClick = this._handleContactClick.bind(this);
    this._handleCloseClick = this._handleCloseClick.bind(this);
    this._handleOverlayClick = this._handleOverlayClick.bind(this);
    this._stopPropagation = this._stopPropagation.bind(this);
    this._handleEscKey = this._handleEscKey.bind(this);

    // Add event listeners
    if (this.gallery) {this.gallery.addEventListener('keydown', this._handleKeyDown);}
    if (this.sendButton) {this.sendButton.addEventListener('click', this._handleContactClick);}
    if (this.closeButton) {this.closeButton.addEventListener('click', this._handleCloseClick);}
    if (this.overlay) {this.overlay.addEventListener('click', this._handleOverlayClick);}
    if (this.productDetail) {this.productDetail.addEventListener('click', this._stopPropagation);}
    document.addEventListener('keydown', this._handleEscKey);

    // Initialize component
    this._renderOverlayHidden();
    this._renderContent();
  }

  disconnectedCallback() {
    if (this.gallery) {this.gallery.removeEventListener('keydown', this._handleKeyDown);}
    if (this.sendButton) {this.sendButton.removeEventListener('click', this._handleContactClick);}
    if (this.closeButton) {this.closeButton.removeEventListener('click', this._handleCloseClick);}
    if (this.overlay) {this.overlay.removeEventListener('click', this._handleOverlayClick);}
    if (this.productDetail) {this.productDetail.removeEventListener('click', this._stopPropagation);}
    document.removeEventListener('keydown', this._handleEscKey);

    if (this._isVisible) {
      this._renderBodyScrollUnlocked();
    }
  }

  attributeChangedCallback(name, oldVal, newVal) {
    if (oldVal === newVal) {return;}
    if (this.mainImg) {
      this._renderContent();
    }
  }

  /**
   * Updates the main image display and product information
   */
  _renderContent() {
    this._renderMainImage();
    this._renderThumbnails();
    this._renderProductInfo();
  }

  /**
   * Updates the main product image display
   */
  _renderMainImage() {
    const images = this.images;
    if (this.mainImg) {
      this.mainImg.src = images[this._currentIndex] || '';
      this.mainImg.alt = this.getAttribute('name') || 'Product image';
    }
  }

  /**
   * Renders thumbnail strip for image navigation
   */
  _renderThumbnails() {
    if (!this.thumbStrip) {return;}
    
    this.thumbStrip.innerHTML = '';
    const images = this.images;
    
    // Only show thumbnails if there are multiple images
    if (images.length > 1) {
      images.forEach((src, idx) => {
        const thumb = document.createElement('img');
        thumb.src = src;
        thumb.alt = `Thumbnail ${idx + 1}`;
        thumb.className = idx === this._currentIndex ? 'active' : '';
        thumb.tabIndex = 0;
        thumb.addEventListener('click', () => this._handleThumbnailClick(idx));
        this.thumbStrip.appendChild(thumb);
      });
    }
  }

  /**
   * Updates all product information text fields
   */
  _renderProductInfo() {
    this._renderTextField('.product-name', this.getAttribute('name'));
    this._renderTextField('.price', this.getAttribute('price') ? `$${this.getAttribute('price')}` : '');
    this._renderTextField('.condition', this.getAttribute('condition'));
    this._renderTextField('.date', this.getAttribute('date'));
    this._renderTextField('.description-block', this.getAttribute('description'));
    this._renderTextField('.lister-name', this.getAttribute('lister-name') || 'Unknown');
  }

  /**
   * Updates a specific text field with new content
   */
  _renderTextField(selector, text) {
    const el = this.shadowRoot.querySelector(selector);
    if (el) {
      el.textContent = text || '';
    }
  }

  /**
   * Hides the overlay and initializes visibility state
   */
  _renderOverlayHidden() {
    if (this.overlay) {
      this.overlay.style.display = 'none';
      this._isVisible = false;
    }
  }

  /**
   * Shows the overlay and locks body scroll
   */
  _renderOverlayVisible() {
    if (this.overlay) {
      this.overlay.style.display = 'block';
      this._isVisible = true;
      this._renderBodyScrollLocked();
      
      if (this.contactMsg) {
        this.contactMsg.placeholder = this.MSG_PLACEHOLDER;
      }
    }
  }

  /**
   * Locks body scroll and adds padding to prevent layout shift
   */
  _renderBodyScrollLocked() {
    document.body.style.overflow = 'hidden';
    document.body.style.paddingRight = this._getScrollbarWidth() + 'px';
  }

  /**
   * Unlocks body scroll and removes padding
   */
  _renderBodyScrollUnlocked() {
    document.body.style.overflow = '';
    document.body.style.paddingRight = '';
  }

  /**
   * Adds disclaimer text after contact button is clicked
   */
  _renderContactDisclaimer() {
    if (this.contactMsg &amp;&amp; !this.shadowRoot.querySelector('.disclaimer-text')) {
      const disclaimer = document.createElement('div');
      disclaimer.className = 'disclaimer-text';
      disclaimer.textContent = '* Chat feature is for demonstration purposes only';
      this.contactMsg.insertAdjacentElement('afterend', disclaimer);
    }
  }

  _handleKeyDown(e) {
    if (e.key === 'ArrowLeft') {
      this._navigateImage(-1);
    }
    if (e.key === 'ArrowRight') {
      this._navigateImage(1);
    }
  }

  _handleContactClick() {
    this.dispatchEvent(new CustomEvent('contact-seller', { 
      bubbles: true, 
      composed: true, 
    }));

    this._renderContactDisclaimer();

    if (typeof window.notify === 'function') {
      window.notify('Message sent to seller!', 'success');
    }
  }

  _handleCloseClick() {
    this.hide();
  }

  _handleOverlayClick(e) {
    if (e.target === this.overlay) {
      this.hide();
    }
  }

  _stopPropagation(e) {
    e.stopPropagation();
  }

  _handleEscKey(e) {
    if (e.key === 'Escape' &amp;&amp; this._isVisible) {
      this.hide();
    }
  }

  _handleThumbnailClick(index) {
    this._currentIndex = index;
    this._renderContent();
  }

  show() {
    this._renderOverlayVisible();
  }

  hide() {
    this._renderOverlayHidden();
    this._renderBodyScrollUnlocked();
  }

  get images() {
    const imagesAttr = this.getAttribute('images') || '';
    
    // Handle both array format (from database) and comma-separated format
    if (imagesAttr.startsWith('[') &amp;&amp; imagesAttr.endsWith(']')) {
      try {
        return JSON.parse(imagesAttr).filter(Boolean);
      } catch (e) {
        console.warn('Failed to parse images JSON:', e);
        return [];
      }
    } else {
      return imagesAttr
        .split(/[\s,]+/)
        .map((s) => s.trim())
        .filter(Boolean);
    }
  }

  _navigateImage(direction) {
    const images = this.images;
    if (images.length === 0) {return;}
    
    this._currentIndex = (this._currentIndex + direction + images.length) % images.length;
    this._renderContent();
  }

  _getScrollbarWidth() {
    const scrollDiv = document.createElement('div');
    scrollDiv.style.cssText = 'width: 100px; height: 100px; overflow: scroll; position: absolute; top: -9999px;';
    document.body.appendChild(scrollDiv);
    
    const scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;
    document.body.removeChild(scrollDiv);
    
    return scrollbarWidth;
  }
}

customElements.define('product-detail', ProductViewer);</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Mon Jun 09 2025 22:23:51 GMT-0700 (Pacific Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
